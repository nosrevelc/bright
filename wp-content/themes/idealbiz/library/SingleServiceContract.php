<?php
/**
 * iDealBiz
 *
 * WARNING: This file is part of the iDealBiz theme. DO NOT edit this file
 * under any circumstances, as the changes will be lost in the case of a theme update.
 * Please do all modifications in the form of a child theme.
 *
 * @since   1.0.0
 * @package iDealBiz\Templates
 * @author  WidgiLabs
 * @license GPL-2.0+
 * @link    http://widgilabs.com/
 */



/**
 * Single listing template.
 *
 * @since  1.0.0
 * @author WidgiLabs <dev@widgilabs.com>
 */
class SingleServiceContract {

	/**
	 * Render the title.
	 *
	 * @since 1.0.0
	 */
	public static function title() {
		printf(
			'%s',
			get_the_title()
		);
	}

	/**
	 * Used to render the contract data.
	 *
	 * @return void
	 * @since 1.0.0
	 * @author Telmo Teixeira <telmo@widgilabs.com>
	 */
	public static function render() {

		$contract_data = array(
			array(
				'name' => __( 'Proposal file', 'idealbiz' ),
				'data' => get_field( 'proposal_file' ),
			),
			array(
				'name' => __( 'Description', 'idealbiz' ),
				'data' => get_field( 'description' ),
			),
			array(
				'name' => __( 'Proposal value', 'idealbiz' ),
				'data' => get_field( 'proposal_value' ),
			),
			array(
				'name' => __( 'Adjudication percentage %', 'idealbiz' ),
				'data' => get_field( 'percentage_adjudication' ),
			),
			array(
				'name' => __( 'Intermediate percentage %', 'idealbiz' ),
				'data' => get_field( 'percentage_intermediate' ),
			),
			array(
				'name' => __( 'Conclusion percentage %', 'idealbiz' ),
				'data' => get_field( 'percentage_conclusion' ),
			),
			array(
				'name' => __( 'Progress', 'idealbiz' ),
				'data' => get_field( 'progress' ),
			),
			array(
				'name' => __( 'Stage', 'idealbiz' ),
				'data' => get_field( 'stage' ),
			),
		);

		$list_items = '';

		foreach ( $contract_data as $value ) {
			$list_items .= "<li><strong>{$value['name']}:</strong> {$value['data']}</li>";
		}

		printf(
			'<ul>
				%1$s
			</ul>',
			wp_kses_post( $list_items )
		);
	}

	/**
	 * Used to prevent access to the service contract single page.
	 *
	 * Redirects to home page if user not authorized.
	 *
	 * @return bool Returns true if is admin or author
	 * @since 1.0.0
	 * @author Telmo Teixeira <telmo@widgilabs.com>
	 */
	public static function protect_service_contract() {
		$user = wp_get_current_user();

		if ( $user->ID === 0 ) {
			wp_redirect( get_bloginfo( 'url' ) );
		}

		$service_request = get_queried_object();

		$is_admin      = in_array( 'administrator', $user->roles, true );
		$is_author     = $user->ID === (int) $service_request->post_author;

		// If one of this is true, move on.
		if ( $is_admin || $is_author ) {
			return true;
		}

		wp_redirect( get_bloginfo( 'url' ) );
	}
}
